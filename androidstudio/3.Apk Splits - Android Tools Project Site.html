<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/276742; Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="896"/>

<div>
<span><div style="position:relative;"><div dir="ltr"><div><div style="clear:both;text-align:left;margin-top:5px;margin-bottom:5px;"><div style="margin-bottom:5px;clear:both;width:1524.7px;border-top-color:rgb(68, 68, 68);border-bottom-color:rgb(68, 68, 68);color:rgb(68, 68, 68);font-size:12px;background-color:rgb(255, 255, 255);"><div style="text-align:left;"><div style="text-align:left;line-height:18px;list-style-type:none;margin-bottom:5px;overflow-x:hidden;overflow-y:hidden;width:1518.7px;border-top-width:1px;border-bottom-width:1px;border-top-style:solid;border-bottom-style:solid;border-top-color:rgb(204, 204, 204);border-bottom-color:rgb(204, 204, 204);padding-top:2px;padding-bottom:2px;background-color:rgb(244, 244, 244);background-image:url(&quot;http://www.gstatic.com/sites/p/d6b6cd/system/app/themes/iceberg/grad.png&quot;);background-repeat:repeat-x;background-position:0% 100%;"><p style="margin-block-start:;margin-block-end:;padding-top:4px;margin-top:0px;margin-bottom:0px;font-weight:700;">Contents</p><ol style="list-style-type:none;margin-block-start:;margin-block-end:;-moz-padding-start:;text-align:left;line-height:18px;"><li style="line-height:18px;list-style-type:none;"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide/apk-splits#TOC-Introduction" style="color:rgb(0, 51, 204);text-decoration-color:rgb(0, 51, 204);border-bottom-color:rgb(0, 51, 204);"><strong>1 </strong>Introduction</a></li><li style="line-height:18px;list-style-type:none;"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide/apk-splits#TOC-Density-Splits" style="color:rgb(0, 51, 204);text-decoration-color:rgb(0, 51, 204);border-bottom-color:rgb(0, 51, 204);"><strong>2 </strong>Density Splits</a></li><li style="line-height:18px;list-style-type:none;"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide/apk-splits#TOC-ABIs-Splits" style="color:rgb(0, 51, 204);text-decoration-color:rgb(0, 51, 204);border-bottom-color:rgb(0, 51, 204);"><strong>3 </strong>ABIs Splits</a></li><li style="line-height:18px;list-style-type:none;"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide/apk-splits#TOC-Variant-API-Version-Code-support." style="color:rgb(0, 51, 204);text-decoration-color:rgb(0, 51, 204);border-bottom-color:rgb(0, 51, 204);"><strong>4 </strong>Variant API &amp; Version Code support.</a></li></ol></div></div></div></div></div><h2 style="font-size:21.3333px;font-weight:400;margin-block-start:;margin-block-end:;color:rgb(68, 68, 68);"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide/null" name="TOC-Introduction" style="color:rgb(0, 51, 204);text-decoration-color:rgb(0, 51, 204);"></a>Introduction</h2><div><span style="line-height:21.3333px;font-size:13.3333px;">The Split mechanism allows applications to be built for some forms of multi-apks more efficiently than using flavors.</span></div><div>The only types of supported multi-apks are</div><div><ul style="margin-block-start:;margin-block-end:;-moz-padding-start:;"><li style="list-style-type:square;">Density</li><li style="list-style-type:square;">ABIs</li></ul><div>Using the new Split mechanism, building a hdpi, and an mdpi version of the same app will share a lot of the tasks (like javac, dx, proguard). Additionally, it will be considered a single variant and the same test app will be used to test every multi-apk.</div></div><div><div></div></div><div>When running the install or the connectedCheck tasks on a variant, Gradle will match the right APK output to each connected devices automatically.</div><div><div></div></div><div>If you want to also do another type of multi-APKs (defined here: http://developer.android.com/google/play/publishing/multiple-apks.html) you can also create Flavors (for instance for API level-based multi-apks), and each variants will have its own multi-outputs.</div><h2 style="font-size:21.3333px;font-weight:400;margin-block-start:;margin-block-end:;color:rgb(68, 68, 68);"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide/null" name="TOC-Density-Splits" style="color:rgb(0, 51, 204);text-decoration-color:rgb(0, 51, 204);"></a>Density Splits</h2><div><div><font face="courier new, monospace">android {</font></div><div><span style="line-height:21.3333px;font-size:13.3333px;"><font face="courier new, monospace">  ...</font></span></div><div><span style="line-height:21.3333px;font-size:13.3333px;"><font face="courier new, monospace">  splits {</font></span></div><div><font face="courier new, monospace">    density {</font></div><div><font face="courier new, monospace">      enable true</font></div><div><font face="courier new, monospace">      exclude &quot;ldpi&quot;, &quot;tvdpi&quot;, &quot;xxxhdpi&quot;</font></div><div><font face="courier new, monospace">      compatibleScreens 'small', 'normal', 'large', 'xlarge'</font></div><div><font face="courier new, monospace">    }</font></div><div><font face="courier new, monospace">  }</font></div><div style="font-size:13.3333px;line-height:21.3333px;"><div></div></div><div style="font-size:13.3333px;line-height:21.3333px;"><b>enable</b>: enables the density split mechanism</div><div style="font-size:13.3333px;line-height:21.3333px;"><b>exclude</b>: By default all densities are included, you can remove some densities.</div><div style="font-size:13.3333px;line-height:21.3333px;"><b>include</b>: indicate which densities to be included</div><div style="font-size:13.3333px;line-height:21.3333px;"><b>reset()</b>: reset the list of densities to be included to an empty string (this allows, in conjunctions with <i>include</i>, to indicate which one to use rather than which ones to ignore)</div><div style="font-size:13.3333px;line-height:21.3333px;"><b>compatibleScreens:</b> indicates a list of compatible screens. This will inject a matching &lt;compatible-screens&gt;&lt;screen ...&gt; node in the manifest. This is optional.</div><div style="font-size:13.3333px;line-height:21.3333px;"><div></div></div><div style="font-size:13.3333px;line-height:21.3333px;">Note that this will also always generate a universal APK with all the densities.</div><div style="font-size:13.3333px;line-height:21.3333px;"><div></div></div><div style="font-size:13.3333px;line-height:21.3333px;">Sample: <font face="courier new, monospace">densitySplit</font></div><h2 style="font-size:21.3333px;font-weight:400;margin-block-start:;margin-block-end:;color:rgb(68, 68, 68);"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide/null" name="TOC-ABIs-Splits" style="color:rgb(0, 51, 204);text-decoration-color:rgb(0, 51, 204);"></a>ABIs Splits</h2></div><div><span><div><font face="courier new, monospace">android {</font></div><div><span style="line-height:21.3333px;font-size:13.3333px;"><font face="courier new, monospace">  ...</font></span></div><div><span style="line-height:21.3333px;font-size:13.3333px;"><font face="courier new, monospace">  splits {</font></span></div><div><font face="courier new, monospace">    abi {</font></div><div><font face="courier new, monospace">      enable true</font></div><div><font face="courier new, monospace">      reset()</font></div><div><font face="courier new, monospace">      include 'x86', 'armeabi-v7a', 'mips'</font></div><div><font face="courier new, monospace">      universalApk true</font></div><div><font face="courier new, monospace">    }</font></div><div><font face="courier new, monospace">  }</font></div><div><font face="courier new, monospace">}</font></div><div style="font-size:13.3333px;line-height:21.3333px;"><div></div></div><div style="font-size:13.3333px;line-height:21.3333px;"><div style="font-size:13.3333px;line-height:21.3333px;"><b>enable</b>: enables the <span style="line-height:21.3333px;">ABIs</span> split mechanism</div><div style="font-size:13.3333px;line-height:21.3333px;"><b>exclude</b>: By default all ABIs are included, you can remove some <span style="line-height:21.3333px;">ABIs</span>.</div><div style="font-size:13.3333px;line-height:21.3333px;"><b>include</b>: indicate which <span style="line-height:21.3333px;">ABIs</span> to be included</div><div style="font-size:13.3333px;line-height:21.3333px;"><b>reset()</b>: reset the list of <span style="line-height:21.3333px;">ABIs</span> to be included to an empty string (this allows, in conjunctions with <i>include</i>, to indicate which one to use rather than which ones to ignore)</div><div><b>universalApk</b>: indicates whether to package a universal version (with all ABIs) or not. Default is false.</div></div><div style="font-size:13.3333px;line-height:21.3333px;"><div></div></div><div style="font-size:13.3333px;line-height:21.3333px;">Sample: <font face="courier new, monospace">ndkSanAngeles</font></div></span></div><h2 style="font-size:21.3333px;font-weight:400;margin-block-start:;margin-block-end:;color:rgb(68, 68, 68);"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide/null" name="TOC-Variant-API-Version-Code-support." style="color:rgb(0, 51, 204);text-decoration-color:rgb(0, 51, 204);"></a>Variant API &amp; Version Code support.</h2><div><b style="line-height:21.3333px;font-size:13.3333px;">Deprecation Warning</b><span style="line-height:21.3333px;font-size:13.3333px;">: the current variant API contains some methods that have moved under its outputs. The method are still there, but will fail if there are 2+ outputs. They will be completely removed in 1.0</span></div><div>These are:</div><div><ul style="margin-block-start:;margin-block-end:;-moz-padding-start:;"><li style="list-style-type:square;">get/setOutputFile</li><li style="list-style-type:square;">getProcessResources</li><li style="list-style-type:square;">getProcessManifest</li><li style="list-style-type:square;">getPackageApplication/Library</li><li style="list-style-type:square;">getZipAlign</li></ul></div><div>Additional methods on VariantOutput</div><div><ul style="margin-block-start:;margin-block-end:;-moz-padding-start:;"><li style="list-style-type:square;">String getAbiFilter()</li><li style="list-style-type:square;">String getDensityFilter()</li><li style="list-style-type:square;">Task getAssemble()</li><li style="list-style-type:square;">String getName()</li><li style="list-style-type:square;">String getBaseName()</li><li style="list-style-type:square;">String getDirName</li><li style="list-style-type:square;">set/getVersionOverride // optional versionCode override</li><li style="list-style-type:square;">int getVersionCode() // returns either the versionCode override from the output or the versionCode from the variant itself</li></ul><div><div></div></div></div><div><div style="line-height:21.3333px;"><span style="line-height:21.3333px;font-size:13.3333px;">Each generated APK must have a different versionCode. Similarly to looping on variants to set the versionCode, you can loop on a variant's outputs and set its versionCodeOverride.</span></div></div><div style="line-height:21.3333px;"><span style="line-height:21.3333px;font-size:13.3333px;"><div></div></span></div><div><span><div><font face="courier new, monospace">// map for the version code</font></div><div><font face="courier new, monospace">ext.versionCodes = ['armeabi-v7a':1, mips:2, x86:3]</font></div><div><font face="courier new, monospace"><div></div></font></div><div><font face="courier new, monospace">import com.android.build.OutputFile</font></div><div><font face="courier new, monospace"><div></div></font></div><div><font face="courier new, monospace">android.applicationVariants.all { variant -&gt;</font></div><div><font face="courier new, monospace">    // assign different version code for each output</font></div><div><font face="courier new, monospace">    variant.outputs.each { output -&gt;</font></div><div><font face="courier new, monospace">        output.versionCodeOverride =</font></div><div><font face="courier new, monospace">            project.ext.versionCodes.get(output.getFilter(OutputFile.ABI)) * 1000000 + android.defaultConfig.versionCode</font></div><div><font face="courier new, monospace">    }</font></div><div><font face="courier new, monospace">}</font></div><div style="font-size:13.3333px;line-height:21.3333px;"><div></div></div></span></div><div>If you are using both flavors and splits for multi-apks, you should still use <font face="courier new, monospace">VariantOutput.setVersionCodeOverride(int)</font> but you should compute the versionCode from both the split info (<font face="courier new, monospace">densityFilter</font> and <font face="courier new, monospace">abiFilter</font>) and the variant info.</div><div><div></div></div></div></div></span>
</div></body></html> 